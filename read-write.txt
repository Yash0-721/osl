#include <stdio.h> 
#include <stdlib.h> 
#include <pthread.h> 
#include <semaphore.h> 
#include <unistd.h> 
#include <stdint.h>  // For intptr_t 
sem_t mutex, writeblock; 
int data = 0, readcount = 0; 
void* reader(void* arg) { 
int f = (intptr_t)arg; 
sem_wait(&mutex); 
readcount++; 
if (readcount == 1) 
sem_wait(&writeblock); 
sem_post(&mutex); 
printf("Reader %d: read data = %d\n", f, data); 
sleep(1); 
sem_wait(&mutex); 
readcount--; 
if (readcount == 0) 
sem_post(&writeblock); 
sem_post(&mutex); 
return NULL; 
} 
void* writer(void* arg) { 
int f = (intptr_t)arg; 
sem_wait(&writeblock); 
data++; 
printf("Writer %d: wrote data = %d\n", f, data); 
sleep(1); 
sem_post(&writeblock); 
return NULL; 
} 
int main() { 
int nReaders, nWriters; 
printf("Enter number of readers: "); 
scanf("%d", &nReaders); 
printf("Enter number of writers: "); 
scanf("%d", &nWriters); 
pthread_t* readers = malloc(nReaders * sizeof(pthread_t)); 
pthread_t* writers = malloc(nWriters * sizeof(pthread_t)); 
sem_init(&mutex, 0, 1); 
sem_init(&writeblock, 0, 1); 
// Create writer threads 
for (int i = 0; i < nWriters; i++) { 
pthread_create(&writers[i], NULL, writer, (void*)(intptr_t)(i + 1)); 
} 
// Create reader threads 
for (int i = 0; i < nReaders; i++) { 
pthread_create(&readers[i], NULL, reader, (void*)(intptr_t)(i + 1)); 
} 
// Join writer threads 
for (int i = 0; i < nWriters; i++) { 
pthread_join(writers[i], NULL); 
} 
// Join reader threads 
for (int i = 0; i < nReaders; i++) { 
pthread_join(readers[i], NULL); 
} 
sem_destroy(&mutex); 
sem_destroy(&writeblock); 
free(readers); 
free(writers); 
return 0; 
} 
//gcc main.c -o rw -lpthread  ./rw
//reader--4 writer--4